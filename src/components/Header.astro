---
const navLinks = [
  { href: '/', label: 'Home' },
  { 
    href: '/services', 
    label: 'Services',
    dropdown: [
      { href: '/services/stump-grinding', label: 'Stump Grinding & Removal' },
      { href: '/services/tree-trimming', label: 'Tree Trimming & Pruning' },
      { href: '/services/debris-haul-away', label: 'Tree Debris Haul Away' }
    ]
  },
  { 
    href: '/service-areas', 
    label: 'Service Areas',
    dropdown: [
      { href: '/service-areas/duval-county', label: 'Duval County' },
      { href: '/service-areas/nassau-county', label: 'Nassau County' },
      { href: '/service-areas/st-johns-county', label: 'St. Johns County' },
      { href: '/service-areas/clay-county', label: 'Clay County' }
    ]
  },
  { href: '/about', label: 'About' },
  { href: '/reviews', label: 'Reviews' },
  { href: '/faq', label: 'FAQ' },
  { href: '/contact', label: 'Contact' },
];
---

<header class="bg-black shadow-lg sticky top-0 z-50">
  <div class="border-b-2 border-brand-yellow">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-24">
        <!-- Logo -->
        <a href="/" class="flex items-center hover:opacity-90 transition">
          <img src="/images/stumpmastersjax.icon.PNG" alt="Stump Masters Jax" class="h-16 w-auto" />
        </a>
        
        <!-- Desktop Navigation -->
        <div class="hidden lg:flex items-center justify-end w-full">
          <!-- Navigation Links -->
          <div class="flex items-center">
            {navLinks.map((link, index) => (
              <>
                {link.dropdown ? (
                  <!-- Dropdown Menu -->
                  <div class="relative group">
                    <a 
                      href={link.href}
                      class="nav-link text-white text-lg font-medium hover:text-brand-yellow transition-all duration-200 relative group px-3 py-2 rounded-md whitespace-nowrap flex items-center gap-1"
                      data-page={link.href}
                    >
                      {link.label}
                      <svg class="w-4 h-4 transition-transform duration-200 group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                      </svg>
                    </a>
                    
                    <!-- Dropdown Content -->
                    <div class="absolute top-full left-0 mt-1 w-64 bg-black border border-brand-yellow rounded-md shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                      <div class="py-2">
                        {link.dropdown.map((item, itemIndex) => (
                          item.items ? (
                            <!-- Multi-tier dropdown -->
                            <div key={itemIndex} class="relative group/submenu">
                              <div class="px-4 py-2 text-brand-yellow font-medium text-sm hover:bg-brand-yellow/10 transition-colors cursor-pointer flex items-center justify-between">
                                {item.label}
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                              </div>
                              
                              <!-- Submenu -->
                              <div class="absolute left-full top-0 ml-1 w-56 bg-black border border-brand-yellow rounded-md shadow-xl opacity-0 invisible group-hover/submenu:opacity-100 group-hover/submenu:visible transition-all duration-200 z-50">
                                <div class="py-2">
                                  {item.items.map((subItem, subIndex) => (
                                    <a 
                                      key={subIndex}
                                      href={subItem.href}
                                      class="block px-4 py-2 text-white text-sm hover:text-brand-yellow hover:bg-brand-yellow/10 transition-colors"
                                      data-page={subItem.href}
                                    >
                                      {subItem.label}
                                    </a>
                                  ))}
                                </div>
                              </div>
                            </div>
                          ) : (
                            <!-- Simple dropdown item -->
                            <a 
                              key={itemIndex}
                              href={item.href}
                              class="block px-4 py-2 text-white text-sm hover:text-brand-yellow hover:bg-brand-yellow/10 transition-colors"
                              data-page={item.href}
                            >
                              {item.label}
                            </a>
                          )
                        ))}
                      </div>
                    </div>
                  </div>
                ) : (
                  <!-- Regular Link -->
                  <a 
                    href={link.href}
                    class="nav-link text-white text-lg font-medium hover:text-brand-yellow transition-all duration-200 relative group px-3 py-2 rounded-md whitespace-nowrap"
                    data-page={link.href}
                  >
                    {link.label}
                    <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-brand-yellow group-hover:w-full transition-all duration-200"></span>
                  </a>
                )}
                {index < navLinks.length - 1 && (
                  <div class="w-px h-6 bg-brand-yellow mx-1"></div>
                )}
              </>
            ))}
          </div>
          
          <!-- Action Buttons -->
          <div class="flex items-center gap-2 ml-6">
            <a 
              href="tel:+19044082450"
              class="nav-call-btn px-3 py-2 h-10 bg-brand-yellow text-black font-bold rounded-md hover:bg-yellow-400 transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 flex items-center gap-2 whitespace-nowrap"
              data-track="nav_call_click"
            >
              <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
              </svg>
              <span class="text-sm">904-408-2450</span>
            </a>
            <button 
              id="header-estimate-btn"
              class="nav-estimate-btn px-3 py-2 h-10 bg-brand-yellow text-black font-bold rounded-md hover:bg-yellow-400 transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 whitespace-nowrap flex items-center justify-center"
              data-track="nav_estimate_click"
            >
              <span class="text-sm">Request Estimate</span>
            </button>
          </div>
        </div>
        
        <!-- Mobile Menu Button -->
        <button 
          id="mobile-menu-btn"
          class="lg:hidden text-white p-2 hover:text-brand-yellow transition"
          aria-label="Toggle menu"
        >
          <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
      
      <!-- Mobile Navigation -->
      <div id="mobile-menu" class="hidden lg:hidden pb-6 pt-2">
        <div class="flex flex-col space-y-2">
          {navLinks.map((link, index) => (
            <div key={index}>
              {link.dropdown ? (
                <!-- Mobile Dropdown -->
                <div>
                  <div class="w-full text-left text-white text-lg font-medium hover:text-brand-yellow transition-colors py-3 px-4 border-b border-gray-800 rounded-md flex items-center justify-between">
                    <span 
                      class="flex-1 cursor-pointer"
                      onclick={`window.location.href='${link.href}'`}
                    >
                      {link.label}
                    </span>
                    <button 
                      class="text-brand-yellow hover:text-yellow-400 transition-colors"
                      onclick="var dropdown = this.parentElement.nextElementSibling; dropdown.classList.toggle('show'); dropdown.classList.toggle('hidden');"
                      aria-label={`Expand ${link.label} dropdown`}
                    >
                      <svg class="w-4 h-4 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                      </svg>
                    </button>
                  </div>
                  
                  <!-- Mobile Dropdown Content -->
                  <div class="mobile-dropdown-content hidden pl-4 space-y-1 mt-1 bg-black border border-gray-700 rounded-md p-2">
                    {link.dropdown.map((item, itemIndex) => (
                      <a 
                        key={itemIndex}
                        href={item.href}
                        class="mobile-nav-link block text-white text-sm py-2 px-3 hover:text-brand-yellow transition-colors"
                        data-page={item.href}
                      >
                        {item.label}
                      </a>
                    ))}
                  </div>
                </div>
              ) : (
                <!-- Mobile Regular Link -->
                <a 
                  href={link.href}
                  class="mobile-nav-link text-white text-lg font-medium hover:text-brand-yellow transition-colors py-3 px-4 border-b border-gray-800 rounded-md"
                  data-page={link.href}
                >
                  {link.label}
                </a>
              )}
            </div>
          ))}
          <a 
            href="tel:+19044082450"
            class="mobile-call-btn mt-4 px-4 py-3 h-12 bg-brand-yellow text-black font-bold rounded-md text-center hover:bg-yellow-400 transition w-full flex items-center justify-center gap-2"
            data-track="mobile_call_click"
          >
            <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
              <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
            </svg>
            <span class="text-sm">904-408-2450</span>
          </a>
          <button 
            id="mobile-estimate-btn"
            class="mobile-estimate-btn mt-3 px-4 py-3 h-12 bg-brand-yellow text-black font-bold rounded-md text-center hover:bg-yellow-400 transition w-full flex items-center justify-center"
            data-track="mobile_estimate_click"
          >
            <span class="text-sm">Request Estimate</span>
          </button>
        </div>
      </div>
    </nav>
  </div>
</header>

<script>
  // Mobile menu functionality
  const btn = document.getElementById('mobile-menu-btn');
  const menu = document.getElementById('mobile-menu');
  
  // Handle both click and touch events for mobile menu
  const toggleMobileMenu = (e) => {
    e.preventDefault();
    if (menu) {
      menu.classList.toggle('hidden');
    }
  };
  
  btn?.addEventListener('click', toggleMobileMenu);
  btn?.addEventListener('touchstart', toggleMobileMenu);
  
  // Close mobile menu when clicking a link
  const mobileLinks = menu?.querySelectorAll('a');
  mobileLinks?.forEach(link => {
    const handleLinkClick = (e) => {
      e.preventDefault();
      // Get the href and navigate
      const href = link.getAttribute('href');
      if (href && href !== '#') {
        window.location.href = href;
      }
      menu?.classList.add('hidden');
    };
    
    link.addEventListener('click', handleLinkClick);
    link.addEventListener('touchstart', handleLinkClick);
  });
  
  // Mobile dropdown functionality
  function initMobileDropdowns() {
    // Handle main dropdown toggles with both click and touch
    const dropdownToggles = document.querySelectorAll('.mobile-dropdown-toggle');
    
    dropdownToggles.forEach(toggle => {
      const handleToggle = (e) => {
        e.preventDefault();
        e.stopPropagation();
        const targetId = toggle.getAttribute('data-target');
        
        const targetDropdown = document.getElementById(`mobile-${targetId}`);
        
        if (targetDropdown) {
          targetDropdown.classList.toggle('hidden');
          
          // Rotate arrow
          const arrow = toggle.querySelector('svg');
          if (arrow) {
            arrow.classList.toggle('rotate-180');
          }
        }
      };
      
      toggle.addEventListener('click', handleToggle);
      toggle.addEventListener('touchstart', handleToggle);
      toggle.addEventListener('touchend', handleToggle);
    });
  }
  
  // Current page highlighting and navigation
  function highlightCurrentPage() {
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.nav-link, .mobile-nav-link');
    
    navLinks.forEach(link => {
      const linkPath = link.getAttribute('data-page');
      
      // Remove existing highlights
      link.classList.remove('bg-brand-yellow/20', 'text-brand-yellow', 'border-brand-yellow', 'font-bold');
      link.style.color = '';
      link.style.fontWeight = '';
      
      // Add highlight to current page
      if (linkPath === currentPath) {
        // Use inline styles to ensure the highlighting works
        link.style.color = '#F2C300';
        link.style.fontWeight = 'bold';
        link.classList.add('font-bold');
        
        // Add yellow border for mobile links
        if (link.classList.contains('mobile-nav-link')) {
          link.classList.add('border-brand-yellow');
        }
      }
    });
  }
  
  // Prevent unnecessary reloads when clicking current page links
  function preventReloads() {
    const currentPath = window.location.pathname;
    
    // Handle nav links
    document.querySelectorAll('.nav-link, .mobile-nav-link').forEach(link => {
      const linkPath = link.getAttribute('data-page');
      if (linkPath === currentPath) {
        link.addEventListener('click', (e) => {
          e.preventDefault();
        });
      }
    });
    
    // Handle logo link
    const logoLink = document.querySelector('a[href="/"]');
    if (logoLink && currentPath === '/') {
      logoLink.addEventListener('click', (e) => {
        e.preventDefault();
      });
    }
  }
  
  // Analytics tracking for navigation
  function trackNavigation(element, eventName) {
    const trackAttr = element?.getAttribute('data-track');
    if (trackAttr && typeof window.trackEvent === 'function') {
      window.trackEvent(trackAttr, {
        page: window.location.pathname,
        element: element.textContent?.trim() || 'unknown'
      });
    }
  }
  
  // Open estimate modal from header buttons
  const headerEstimateBtn = document.getElementById('header-estimate-btn');
  const mobileEstimateBtn = document.getElementById('mobile-estimate-btn');
  
  function openEstimateModal() {
    const modal = document.getElementById('estimate-modal');
    modal?.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
    menu?.classList.add('hidden'); // Close mobile menu if open
    
    // Track modal open
    if (typeof window.trackEvent === 'function') {
      window.trackEvent('estimate_modal_open', {
        source: 'navigation',
        page: window.location.pathname
      });
    }
  }
  
  // Event listeners
  headerEstimateBtn?.addEventListener('click', () => {
    openEstimateModal();
    trackNavigation(headerEstimateBtn, 'nav_estimate_click');
  });
  
  mobileEstimateBtn?.addEventListener('click', () => {
    openEstimateModal();
    trackNavigation(mobileEstimateBtn, 'mobile_estimate_click');
  });
  
  // Track navigation link clicks
  document.querySelectorAll('.nav-link, .mobile-nav-link').forEach(link => {
    link.addEventListener('click', () => {
      trackNavigation(link, 'nav_link_click');
    });
  });
  
  // Track call button clicks
  document.querySelectorAll('.nav-call-btn, .mobile-call-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      trackNavigation(btn, btn.getAttribute('data-track'));
    });
  });
  
  // Initialize everything on page load
  document.addEventListener('DOMContentLoaded', () => {
    highlightCurrentPage();
    preventReloads();
  });
  
  // Re-highlight on navigation (for SPA-like behavior)
  window.addEventListener('popstate', highlightCurrentPage);
</script>
